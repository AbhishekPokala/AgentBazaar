Agentic Marketplace — Engineering Kickoff Document
Purpose: This document provides a complete engineering plan so all three engineers can onboard instantly, share with Cursor, and begin executing. It is concise, complete, and builds the entire system end‑to‑end.

1. High-Level Architecture
The system consists of 5 tightly-defined components:
1. API Layer (FastAPI)
Backend responsible for:
Agent registry access (/agents)


Task creation (/task)


Agent invocation (/invoke-agent)


Internal payments via Locus (/payments/locus)


External payments via Stripe (/payments/stripe/*)


Logging execution traces (/logs/task/{id})


DB integration


Uniform execution pipeline for all agents (real + mock)


2. UI Layer (Next.js)
Frontend responsible for:
Marketplace page (list of agents)


Agent detail page


HubChat chat UI


Payment logs UI


Task execution logs


3. HubChat (Anthropic Agent SDK)
Central orchestrator agent that:
Parses user intent


Extracts required skills


Plans multi-step workflows


Selects appropriate agents


Negotiates price (if applicable)


Computes internal + external cost breakdown


Calls API for invoking agents + payments


Aggregates results


Returns structured responses to UI


HubChat never calls agents or payments directly — it only calls our API tools.
4. Services Layer (Agents)
Collection of real + mock agents, each exposing a uniform HTTP POST /execute endpoint:
Real Agents: Summarizer, Translator, Sentiment, PDF Formatter


Mock Agents: BusyAgent, HighPriceAgent, NegotiationAgent


Agents must implement:
{
  "result": "...",
  "cost": 0.15,
  "subtask_type": "translate",
  "requires_external_tool": false,
  "external_cost": 0
}

5. DB Layer
Stores:
agent metadata


dynamic pricing + load


agent earnings (BazaarBucks)


task definitions


task logs


payment logs (Locus + Stripe)


session history


SQLite or Postgres recommended.

2. Folder Structure (Your Repo Layout)
/agentic-marketplace
    /api
        main.py
        /routes
            agents.py
            tasks.py
            payments.py
            logs.py
        /models
        /schemas
        /services
        /db
    /hubchat
        orchestrator.py
        planner.py
        tools.py
        prompts.py
    /services
        summarizer/app.py
        translator/app.py
        sentiment/app.py
        mock_busy/app.py
        mock_highprice/app.py
        mock_negotiator/app.py
    /ui
        /components
        /pages
        /styles
    /infra
        docker-compose.yml (optional)


3. Detailed API Contract Definitions
GET /agents
Returns registry of all agents.
Response:
[
  {
    "id": "translator",
    "name": "Translator Agent",
    "skills": ["translate"],
    "base_price": 0.15,
    "dynamic_price": 0.15,
    "load": 2,
    "rating": 4.8,
    "jobs_completed": 241,
    "endpoint_url": "http://translator:8001/execute"
  }
]


POST /task
HubChat creates a task before execution.
Request:
{
  "user_query": "Summarize and translate this text",
  "required_skills": ["summarize", "translate"],
  "planned_subtasks": [
    {"agent_id": "summarizer", "estimated_cost": 0.10},
    {"agent_id": "translator", "estimated_cost": 0.15}
  ],
  "max_budget": 1.00
}

Response:
{ "task_id": "task123", "status": "created" }


POST /invoke-agent
Executes a specific agent.
Request:
{
  "agent_id": "translator",
  "task_id": "task123",
  "payload": { "text": "...", "language": "fr" }
}

Response:
{
  "result": "...translated text...",
  "cost": 0.15,
  "subtask_type": "translate",
  "requires_external_tool": false,
  "external_cost": 0
}


POST /payments/locus
Internal micro-transaction for BazaarBucks.
Request:
{
  "task_id": "task123",
  "agent_id": "translator",
  "amount": 0.15
}


POST /payments/stripe/card-spend
External real-world payment.
Request:
{
  "agent_id": "formatter",
  "amount": 0.70,
  "vendor": "Font API"
}


GET /logs/task/{id}
{
  "task_id": "task123",
  "steps": [
    {"agent": "summarizer", "cost": 0.10, "output": "..."},
    {"agent": "translator", "cost": 0.15, "output": "..."}
  ],
  "payments": [...],
  "final_output": "..."
}


4. HubChat: Tools + Responsibilities
HubChat uses Anthropic Agent SDK. It does:
Plan tasks


Select agents


Negotiate prices with mock agents


Compute cost breakdown


Trigger payments via API


Invoke agents via API


Tools exposed to HubChat:
Tool: list_agents
Calls GET /agents


Tool: create_task
Calls POST /task


Tool: invoke_agent
Calls POST /invoke-agent


Tool: trigger_locus_payment
Calls POST /payments/locus


Tool: trigger_stripe_card_spend
Calls POST /payments/stripe/card-spend


Tool: fetch_logs
Calls GET /logs/task/{id}



5. Money Flow (Internal + External)
1. User loads $10 → Stripe Checkout → Platform balance
2. Platform mints 100 BazaarBucks → stored in Locus
3. HubChat assigns tasks → agents earn BB via /payments/locus
4. If an agent needs external tools → Stripe virtual card is used
5. BazaarBucks → USD payouts are OPTIONAL (mock or Stripe Connect)
The internal economy (Locus) and external economy (Stripe) stay separate.

6. MVP Work Division (3 Engineers)
Engineer 1 — API + DB (Backend Lead)
FastAPI skeleton


All endpoints


DB models + migrations


Payment integration wrappers (Locus + Stripe)


Agent invocation pipeline


Task logging


Engineer 2 — HubChat (Orchestration Lead)
Anthropic Agent SDK setup


Tool definitions


Planner logic


Agent selection


Negotiation logic


Cost breakdown


End-to-end chaining


Engineer 3 — UI + Agents (Frontend + Agent Lead)
UI:
Next.js setup


Marketplace page


Agent cards


HubChat chat interface


Logs + payments UI


Agents:
Implement 3 real agents


Implement 2–3 mock agents



7. First Day Sprint Plan (MVP in First 4 Hours)
Hour 1
Backend: GET /agents static JSON + DB setup


HubChat: basic SDK init, dummy tool


UI: marketplace skeleton


Agents: Summarizer stub


Hour 2
Backend: /invoke-agent pipeline


HubChat: planning + invoking 1 agent


UI: Chat input + backend hook


Agents: Translator stub


Hour 3
Backend: /payments/locus


HubChat: internal economy + cost reasoning


UI: show cost breakdown


Agents: Mock pricing agent


Hour 4
Backend: /payments/stripe/card-spend


HubChat: external tool decision


UI: logs UI


Agents: Formatter with optional Stripe card call


